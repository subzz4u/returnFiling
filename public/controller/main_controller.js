/*****************************************************************************************************************/
/*****************************************************************************************************************/
/*****************************************************************************************************************/
app.controller("Main_Controller",function($scope,$rootScope,$state,$localStorage,NgTableParams,ApiCall,UserModel,$uibModal,$stateParams,Util,$timeout){
  $scope.userList = {};
  $scope.count = {};
  $scope.users = {};
  /*******************************************************/
  /*********FUNCTION IS USED TO SIGN OUT PROFILE**********/
  /*******************************************************/
  $scope.signOut = function(){
    delete $localStorage.token;
    $rootScope.is_loggedin = false;
    $state.go('login');
  }

  /*******************************************************/
  /*********FUNCTION IS USED TO GET USER LIST*************/
  /*******************************************************/
  $scope.getAllUsers = function(){
    ApiCall.getUser(function(response){
      $scope.users.nos = response.data.length;
      $scope.userList = response.data;
      $scope.userData = new NgTableParams;
      $scope.userData.settings({
        dataset: $scope.userList
      })
      },function(error){
      })
  }
  /*******************************************************/
  /*********FUNCTION IS USED TO CHECK ADMIN USER**********/
  /*******************************************************/
  $scope.checkAdmin = function(){
    $scope.superAdmin = false;
    $timeout(function() {
      var loggedIn_user = UserModel.getUser();
      if(loggedIn_user.role.type == "superAdmin"){
        $scope.superAdmin = true;
      }
    }, 500);
  }
  /*******************************************************/
  /******FUNCTION IS USED TO OPEN DELETE USER MODAL*******/
  /*******************************************************/
  $scope.deleteUser = function(data){
   $scope.deleteUserId = data._id;
   $scope.modalInstance = $uibModal.open({
      animation : true,
      templateUrl : 'view/modals/user-delete-modal.html',
      controller : 'daleteUserModalCtrl',
      size: 'md',
      resolve:{
        userDelete : function(){
           return $scope.userDelete;
        }
      }
   })
  }
  /*******************************************************/
  /*********FUNCTION IS USED TO DELETE USER***************/
  /*******************************************************/
  $scope.userDelete = function(){
    ApiCall.deleteUser({
      _id: $scope.deleteUserId
    }, function(res) {
      Util.alertMessage('success', res.message);
      $scope.getAllUsers();
    }, function(error) {
    })
  }
  /*******************************************************/
  /******FUNCTION IS USED TO GET RETURN FILE COUNT********/
  /*******************************************************/
  $scope.getReturnCount = function(){
    ApiCall.getcount(function(response){
     $scope.count.nos = response.data.length;
    },function(error){
    })
  }
});
/*****************************************************************************************************************/
/*****************************************************************************************************************/
/*****************************************************************************************************************/
app.controller('daleteUserModalCtrl',function($scope, $uibModalInstance,userDelete){
  $scope.ok = function () {
    userDelete();
    $uibModalInstance.close();
  };
  $scope.cancel = function () {
    $uibModalInstance.dismiss('cancel');
  };
});
/*****************************************************************************************************************/
/*****************************************************************************************************************/
/*****************************************************************************************************************/

/*****************************************************************************************************************/
/*****************************************************************************************************************/
/*****************************************************************************************************************/

/*****************************************************************************************************************/
/*****************************************************************************************************************/
/*****************************************************************************************************************/

/*****************************************************************************************************************/
/*****************************************************************************************************************/
/*****************************************************************************************************************/
