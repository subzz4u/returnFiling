var app=angular.module("return_file",["ui.router","ui.bootstrap","ngResource","ngStorage","ngAnimate","datePicker","ngTable","angular-js-xlsx","WebService"]);app.config(["$stateProvider","$urlRouterProvider","$httpProvider",function(a,b,c){function d(a,b,c,d,e,f,g){var h=a.defer();e.get("/user/loggedin").success(function(a){b(function(){c.is_loggedin=!0,g.setUser(a.user),h.resolve()},200)}).error(function(a){b(function(){f.token=null,c.is_loggedin=!1,h.resolve(),d.go("login")},200)})}function e(a,b,c,d,e,f){var g=a.defer();d.get("/user/loggedin").success(function(a){b(function(){c.is_loggedin=!0,g.resolve(),e.go("dashboard")},200)}).error(function(a){b(function(){f.token=null,c.is_loggedin=!1,g.resolve()},200)})}e.$inject=["$q","$timeout","$rootScope","$http","$state","$localStorage"],d.$inject=["$q","$timeout","$rootScope","$state","$http","$localStorage","UserModel"],c.interceptors.push(["$q","$location","$window","$localStorage",function(a,b,c,d){return{request:function(a){a.url.indexOf("login")>-1;return d.token&&(a.headers=a.headers||{},a.headers.Authorization="bearer "+d.token),a},response:function(c){return 401===c.status&&b.path("/"),c||a.when(c)}}}]),b.otherwise("/login"),a.state("login",{templateUrl:"view/common/login.html",url:"/login",controller:"Login_Controller",resolve:{loggedout:e}}).state("sign-up",{templateUrl:"view/common/sign_up.html",url:"/sign-up",controller:"User_Controller",resolve:{loggedout:e}}).state("dashboard",{templateUrl:"view/dashboard.html",url:"/dashboard",controller:"Main_Controller",resolve:{loggedout:d}}).state("profile-update",{templateUrl:"view/profile_update.html",url:"/profile-update",controller:"User_Controller",resolve:{loggedout:d}}).state("user-profile",{templateUrl:"view/user_profile.html",url:"/user-profile/:user_id",controller:"User_Controller",resolve:{loggedout:d}}).state("user-list",{templateUrl:"view/user_list.html",url:"/user-list",controller:"User_Controller",resolve:{loggedout:d}}).state("return-file",{templateUrl:"view/return_file.html",url:"/return-file",controller:"Return_Controller",resolve:{loggedout:d}}).state("return-file-list",{templateUrl:"view/return_file_list.html",url:"/return-file-list",controller:"Return_Controller",resolve:{loggedout:d}}).state("return-file-details",{templateUrl:"view/return_file_details.html",url:"/return-file-details",controller:"Return_Controller",resolve:{loggedout:d}}).state("payment",{templateUrl:"view/payment.html",url:"/payment",controller:"Return_Controller",resolve:{loggedout:d}})}]),app.run(["$http","$rootScope","$localStorage","$timeout","EnvService","Constants",function(a,b,c,d,e,f){b.$on("$stateChangeSuccess",function(a,c,d,e,f){b.stateName=c.name}),e.setSettings(f)}]),app.factory("Util",["$rootScope","$timeout",function(a,b){var c={};return a.alerts=[],c.alertMessage=function(c,d){var e={type:c,msg:d};a.alerts.push(e),b(function(){a.alerts.splice(a.alerts.indexOf(e),1)},5e3)},c}]),app.filter("getShortName",function(){return function(a){if(a){var b=angular.copy(a);return b=b.split(" "),b=b[0].charAt(0)+b[b.length-1].charAt(0),b.toUpperCase()}}}),app.filter("dateformat",function(){return function(a){if(a)return moment(a).format("DD MMM, YYYY")}}),app.constant("Constants",{debug:!0,storagePrefix:"goAppAccount$",getTokenKey:function(){return this.storagePrefix+"token"},getLoggedIn:function(){return this.storagePrefix+"loggedin"},alertTime:3e3,getUsername:function(){return this.storagePrefix+"username"},getPassword:function(){return this.storagePrefix+"password"},getIsRemember:function(){return this.storagePrefix+"isRemember"},hashKey:"goAppAccount",envData:{env:"dev",dev:{basePath:"http://localhost:4000",appPath:"http://localhost:4000"},prod:{basePath:"http://localhost:4000",appPath:"http://localhost:4000"}}}),angular.module("WebService",[]).factory("API",["$http","$resource","EnvService",function(a,b,c){return{getRole:{url:"/role/",method:"GET"},postRole:{url:"/role",method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"}},updateRole:{url:"/role/",method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"}},deleteRole:{url:"/role/:_id",method:"DELETE",headers:{"Content-Type":"application/json",Accept:"application/json"}},userLogin:{url:"/user/login",method:"POST"},getUser:{url:"/user/",method:"GET"},postUser:{url:"/user/",method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"}},deleteUser:{url:"/user/:_id",method:"DELETE",headers:{"Content-Type":"application/json",Accept:"application/json"}},updateUser:{url:"/user/",method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"}},postClient:{url:"/client",method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"}},postReturnFile:{url:"/returnFile",method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"}},getcount:{url:"/returnFile/count",method:"GET"},getReturnList:{url:"/returnFile",method:"GET"},getItr:{url:"/returnFile/itr",method:"GET"},postTransaction:{url:"/returnFile/transaction",method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"}},getFiscalYear:{url:"/returnFile/fiscalYear",method:"GET"},getReturnFile:{url:"/returnFile",method:"GET"}}}]).factory("ApiCall",["$http","$resource","API","EnvService","ApiGenerator",function(a,b,c,d,e){return b("/",null,{getRole:e.getApi("getRole"),userLogin:e.getApi("userLogin"),getUser:e.getApi("getUser"),postUser:e.getApi("postUser"),getFiscalYear:e.getApi("getFiscalYear"),deleteUser:e.getApi("deleteUser"),updateUser:e.getApi("updateUser"),postReturnFile:e.getApi("postReturnFile"),getcount:e.getApi("getcount"),getReturnList:e.getApi("getReturnList"),getReturnFile:e.getApi("getReturnFile"),getItr:e.getApi("getItr"),postTransaction:e.getApi("postTransaction")})}]).factory("ApiGenerator",["$http","$resource","API","EnvService",function(a,b,c,d){return{getApi:function(a){var b={};return b=angular.copy(c[a]),b.url=d.getBasePath()+b.url,b}}}]).factory("EnvService",["$http","$localStorage",function(a,b){var c=env={},d={};return{setSettings:function(a){d=a,this.setEnvData(a.envData)},getSettings:function(a){return a?d[a]:null},setEnvData:function(a){c=a[a.env]},getEnvData:function(){return c},getBasePath:function(a){return this.getEnvData().basePath}}}]),app.factory("UserModel",function(){var a={};return a.setUser=function(b){a.user=b},a.getUser=function(b){return a.user},a.unsetUser=function(b){a.user=null},a}),app.controller("Main_Controller",["$scope","$rootScope","$state","$localStorage","NgTableParams","ApiCall","UserModel","$uibModal","$stateParams","Util","$timeout",function(a,b,c,d,e,f,g,h,i,j,k){a.userList={},a.count={},a.users={},a.signOut=function(){delete d.token,b.is_loggedin=!1,c.go("login")},a.getAllUsers=function(){f.getUser(function(b){a.users.nos=b.data.length,a.userList=b.data,a.userData=new e,a.userData.settings({dataset:a.userList})},function(a){})},a.checkAdmin=function(){a.superAdmin=!1,k(function(){var b=g.getUser();"superAdmin"==b.role.type&&(a.superAdmin=!0)},500)},a.deleteUser=function(b){a.deleteUserId=b._id,a.modalInstance=h.open({animation:!0,templateUrl:"view/modals/user-delete-modal.html",controller:"daleteUserModalCtrl",size:"md",resolve:{userDelete:function(){return a.userDelete}}})},a.userDelete=function(){f.deleteUser({_id:a.deleteUserId},function(b){j.alertMessage("success",b.message),a.getAllUsers()},function(a){})},a.getReturnCount=function(){f.getcount(function(b){a.count.nos=b.data.length},function(a){})}}]),app.controller("daleteUserModalCtrl",["$scope","$uibModalInstance","userDelete",function(a,b,c){a.ok=function(){c(),b.close()},a.cancel=function(){b.dismiss("cancel")}}]),app.controller("User_Controller",["$scope","$timeout","$rootScope","$state","$localStorage","NgTableParams","ApiCall","UserModel","Util","$stateParams",function(a,b,c,d,e,f,g,h,i,j){a.user={},a.tempAdhar={},a.tempPAN={},a.active_tab="details",a.userDetails={},a.tabChange=function(b){a.active_tab=b},a.getRoll=function(){g.getRole(function(b){angular.forEach(b.data,function(b){"client"==b.type&&(a.user.role=b._id)})})},a.checkPassword=function(b,c){b!=c&&(a.showPasswordMisMatch=!0),b==c&&(a.showPasswordMisMatch=!1)},a.registerUser=function(){c.showPreloader=!0,g.postUser(a.user,function(a){c.showPreloader=!1,200==a.statusCode?(i.alertMessage("success","You have successfully register please check your mail"),d.go("login")):i.alertMessage("danger","Something went wrong please try again")},function(a){c.showPreloader=!1})},a.profileUpdate=function(){a.tempAdhar.imageName&&(a.user.adharDetails={fileName:a.tempAdhar.imageName,base64:a.tempAdhar.image.split(";base64,")[1]}),a.tempPAN.imageName&&(a.user.panDetails={fileName:a.tempPAN.imageName,base64:a.tempPAN.image.split(";base64,")[1]}),a.user._id=h.getUser()._id,g.updateUser(a.user,function(a){h.setUser(a.data.user),e.token=a.data.token;var b=h.getUser();i.alertMessage("success","Data Updated Successfully"),d.go("user-profile",{user_id:b._id})},function(a){console.log("updateUser  "+a)})},a.getUserDetails=function(){b(function(){if(a.user=h.getUser(),a.user||j.user_id){var b={_id:j.user_id||a.user._id};g.getUser(b,function(b){a.userDetails=b.data},function(a){})}})}}]),app.controller("Login_Controller",["$scope","$rootScope","$rootScope","$state","$localStorage","NgTableParams","ApiCall","$timeout","UserModel",function(a,b,b,c,d,e,f,g,h){a.user={},a.user.username=d.user?d.user.uname:"",a.user.password=d.user?d.user.password:"",a.userLogin=function(){b.showPreloader=!0,f.userLogin(a.user,function(e){a.user.rememberMe&&(d.user={uname:a.user.username,password:a.user.password}),b.showPreloader=!1,d.token=e.data.token,b.is_loggedin=!0,e.data.user.firstname?c.go("user-profile",{user_id:e.data.user._id}):c.go("profile-update")},function(a){})}}]),app.controller("Payment_Controller",["$scope","$rootScope","$rootScope","$state","$localStorage","NgTableParams","ApiCall","$timeout",function(a,b,b,c,d,e,f,g){}]),app.controller("Return_Controller",["$scope","$rootScope","$rootScope","$state","$localStorage","NgTableParams","ApiCall","Util","$timeout","UserModel",function(a,b,b,c,d,e,f,g,h,i){a.user={},a.active_tab1="income",a.list={},a.itrIdList={},a.yearList={},a.active_tab="year",a.tabChange=function(b){a.active_tab=b},a.tabChangeDetails=function(b){a.active_tab1=b},a.change=function(){},a.returnFile=function(){a.user.client=i.getUser()._id,f.postReturnFile(a.user,function(a){g.alertMessage("success","Data Saved Successfully");var b=i.getUser();c.go("user-profile",{user_id:b._id})},function(a){})},a.returnFileList=function(){f.getReturnList(function(b){a.list=b.data,a.returnList=new e,a.returnList.settings({dataset:a.list})},function(a){})},a.showFiscalYear=function(){f.getFiscalYear(function(b){a.yearList=b.data,console.log(a.yearList)},function(a){})},a.getItrId=function(){f.getItr(function(b){a.itrIdList=b.data},function(a){})},a.returnFileDetails=function(){console.log(a.user.fiscalYear);var b={fiscalYear:a.user.fiscalYear};f.getReturnFile(b,function(b){a.user=b.data,console.log(a.user)},function(a){})},a.paymentConfirm=function(){f.postTransaction(a.user,function(a){g.alertMessage("success","Payment Confirmed Successfully");var b=i.getUser();c.go("user-profile",{user_id:b._id})},function(a){})}}]),app.directive("fileModell",["$parse",function(a){return{restrict:"A",link:function(b,c,d){var e=a(d.fileModel),f=e.assign;c.bind("change",function(){b.$apply(function(){f(b,c[0].files[0])})})}}}]),app.directive("updateHeight",function(){return{restrict:"A",link:function(a,b,c){$ta=b;var d=$(window).height();$ta.css({"min-height":d-100+"px"})}}}),app.directive("fileModel",["$parse",function(a){return{restrict:"A",scope:{fileread:"=",filename:"="},link:function(a,b,c){b.bind("change",function(){var c=new FileReader;c.onload=function(c){a.$apply(function(){a.fileread=c.target.result,a.filename=b[0].files[0].name})},c.readAsDataURL(b[0].files[0])})}}}]);