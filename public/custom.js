var app=angular.module("return_file",["ui.router","ui.bootstrap","ngResource","ngStorage","ngAnimate","datePicker","ngTable","angular-js-xlsx","WebService","ui.utils","textAngular","Logger"]);app.config(["$stateProvider","$urlRouterProvider","$httpProvider",function(a,b,c){function d(a,b,c,d,e,f,g){var h=a.defer();e.get("/user/loggedin").success(function(a){b(function(){c.is_loggedin=!0,g.setUser(a.user),"dashboard"==d.current.name&&"client"==g.getUser().role.type&&d.go("user-profile"),console.log("$state >>>>> ",d.current.name),h.resolve()},200)}).error(function(a){b(function(){f.token=null,c.is_loggedin=!1,h.resolve(),d.go("login")},200)})}function e(a,b,c,d,e,f){var g=a.defer();d.get("/user/loggedin").success(function(a){b(function(){c.is_loggedin=!0,g.resolve(),e.go("dashboard")},200)}).error(function(a){b(function(){f.token=null,c.is_loggedin=!1,g.resolve()},200)})}e.$inject=["$q","$timeout","$rootScope","$http","$state","$localStorage"],d.$inject=["$q","$timeout","$rootScope","$state","$http","$localStorage","UserModel"],c.interceptors.push(["$q","$location","$window","$localStorage",function(a,b,c,d){return{request:function(a){a.url.indexOf("login")>-1;return d.token&&(a.headers=a.headers||{},a.headers.Authorization="bearer "+d.token),a},response:function(c){return 401===c.status&&b.path("/"),c||a.when(c)}}}]),b.otherwise("/login"),a.state("login",{templateUrl:"view/common/login.html",url:"/login",controller:"Login_Controller",resolve:{loggedout:e}}).state("sign-up",{templateUrl:"view/common/sign_up.html",url:"/sign-up",controller:"User_Controller",resolve:{loggedout:e}}).state("dashboard",{templateUrl:"view/dashboard.html",url:"/dashboard",controller:"Main_Controller",resolve:{loggedout:d}}).state("profile-update",{templateUrl:"view/profile_update.html",url:"/profile-update",controller:"User_Controller",resolve:{loggedout:d}}).state("user-profile",{templateUrl:"view/user_profile.html",url:"/user-profile/:user_id",controller:"User_Controller",resolve:{loggedout:d}}).state("user-details",{templateUrl:"view/user_details.html",url:"/user-details/:user_id",controller:"User_Controller",resolve:{loggedout:d}}).state("user-list",{templateUrl:"view/user_list.html",url:"/user-list/:userType",controller:"User_Controller",params:{userType:null},resolve:{loggedout:d}}).state("new-user",{templateUrl:"view/new_user.html",url:"/new-user",controller:"User_Controller",resolve:{loggedout:d}}).state("return-file",{templateUrl:"view/return_file.html",url:"/return-file",controller:"Return_Controller",resolve:{loggedout:d}}).state("return-file-list",{templateUrl:"view/return_file_list.html",url:"/return-file-list/:status",controller:"Return_Controller",resolve:{loggedout:d}}).state("previous-return-file-details",{templateUrl:"view/previous_return_file_details.html",url:"/previous-return-file-details/:client_id",controller:"Return_Controller",params:{client_id:null},resolve:{loggedout:d}}).state("payment",{templateUrl:"view/payment.html",url:"/payment",controller:"Return_Controller",resolve:{loggedout:d}}).state("returnFile-details",{templateUrl:"view/returnFile-details.html",url:"/returnFile-details/:returnFile_id",controller:"Return_Controller",params:{returnFile_id:null},resolve:{loggedout:d}}).state("emailConfig",{templateUrl:"view/emailConfig.html",url:"/emailConfig",controller:"EmailConfig_Controller",resolve:{loggedout:d}}).state("change-password",{templateUrl:"view/change_password.html",url:"/change-password",controller:"User_Controller",resolve:{loggedout:d}}).state("forgot-password",{templateUrl:"view/forgot_password.html",url:"/forgot-password",controller:"User_Controller",resolve:{loggedout:e}}).state("work-assignment",{templateUrl:"view/work_assignment.html",url:"/work-assignment",controller:"Work_Assignment_Controller",resolve:{loggedout:d}}).state("work-assigned",{templateUrl:"view/works-assigned.html",url:"/work-assigned",controller:"Work_Assignment_Controller",resolve:{loggedout:d}}).state("work-not-assigned",{templateUrl:"view/works-not-assigned.html",url:"/work-not-assigned",controller:"Work_Assignment_Controller",resolve:{loggedout:d}}).state("create-task",{templateUrl:"view/task_create.html",url:"/create-task",controller:"Work_Assignment_Controller",resolve:{loggedout:d}}).state("task-list",{templateUrl:"view/task_list.html",url:"/task-list",controller:"Work_Assignment_Controller",resolve:{loggedout:d}}).state("work-details",{templateUrl:"view/work_details.html",url:"/work-details/:job_id",controller:"Work_Assignment_Controller",resolve:{loggedout:d},params:{job_id:null}}).state("template",{templateUrl:"view/template.html",url:"/template/:_id",params:{_id:null,data:null},controller:"EmailConfig_Controller",resolve:{loggedout:d}}).state("addTemplate",{templateUrl:"view/template.html",url:"/template",controller:"EmailConfig_Controller",resolve:{loggedout:d}}).state("referral-list",{templateUrl:"view/referralList.html",url:"/referral-list/:referal_id",controller:"Referral_Controller",params:{referal_id:null},resolve:{loggedout:d}}).state("referral-overview",{templateUrl:"view/referralOverview.html",url:"/referral-overview",controller:"Referral_Controller",resolve:{loggedout:d}})}]),app.run(["$http","$rootScope","$localStorage","$timeout","EnvService","Constants",function(a,b,c,d,e,f){b.$on("$stateChangeSuccess",function(a,c,d,e,f){b.stateName=c.name}),e.setSettings(f)}]),app.factory("Util",["$rootScope","$timeout",function(a,b){var c={};return a.alerts=[],c.alertMessage=function(c,d){d||(d=c);var e={type:c,msg:d};a.alerts.push(e),b(function(){a.alerts.splice(a.alerts.indexOf(e),1)},5e3)},c}]),app.filter("getShortName",function(){return function(a){if(a){var b=angular.copy(a);return b=b.split(" "),b=b[0].charAt(0)+b[b.length-1].charAt(0),b.toUpperCase()}}}),app.filter("dateformat",function(){return function(a){if(a)return moment(a).format("DD MMM, YYYY")}}),app.filter("getShortName",function(){return function(a){if(a){var b=angular.copy(a);return b=b.split(" "),b=b[0].charAt(0)+b[b.length-1].charAt(0),b.toUpperCase()}}}),app.filter("capitalize",function(){return function(a){return a?a.charAt(0,3).toUpperCase():""}}),app.constant("Constants",{debug:!0,storagePrefix:"goAppAccount$",getTokenKey:function(){return this.storagePrefix+"token"},getLoggedIn:function(){return this.storagePrefix+"loggedin"},alertTime:3e3,getUsername:function(){return this.storagePrefix+"username"},getPassword:function(){return this.storagePrefix+"password"},getIsRemember:function(){return this.storagePrefix+"isRemember"},hashKey:"goAppAccount",envData:{env:"dev",dev:{basePath:"http://localhost",appPath:"http://localhost"},prod:{basePath:"http://ec2-52-23-158-141.compute-1.amazonaws.com",appPath:"http://ec2-52-23-158-141.compute-1.amazonaws.com"}}}),angular.module("Logger",[]).factory("LOG",["$rootScope","$timeout",function(a,b){return{debug:function(a){console.log(a)},info:function(c){var d={type:"success",msg:c};a.alerts.push(d),b(function(){a.alerts.splice(a.alerts.indexOf(d),1)},5e3)},error:function(c){var d={type:"error",msg:c};a.alerts.push(d),b(function(){a.alerts.splice(a.alerts.indexOf(d),1)},5e3)}}}]),angular.module("WebService",[]).factory("API",["$http","$resource","EnvService",function(a,b,c){return{getRole:{url:"/role/",method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}},postRole:{url:"/role",method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"}},updateRole:{url:"/role/",method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"}},deleteRole:{url:"/role/:_id",method:"DELETE",headers:{"Content-Type":"application/json",Accept:"application/json"}},userLogin:{url:"/user/login",method:"POST"},getUser:{url:"/user/",method:"GET"},postUser:{url:"/user/",method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"}},deleteUser:{url:"/user/:_id",method:"DELETE",headers:{"Content-Type":"application/json",Accept:"application/json"}},updateUser:{url:"/user/",method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"}},postClient:{url:"/client",method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"}},postReturnFile:{url:"/returnFile",method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"}},getcount:{url:"/returnFile/count",method:"GET"},getReferral:{url:"/referral/count",method:"GET"},getReferralList:{url:"/referral",method:"GET"},getOverview:{url:"/referral/overview",method:"GET"},getReturnList:{url:"/returnFile",method:"GET"},getItr:{url:"/returnFile/itr",method:"GET"},postTransaction:{url:"/returnFile/transaction",method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"}},getFiscalYear:{url:"/returnFile/fiscalYear",method:"GET"},getReturnFile:{url:"/returnFile",method:"GET"},updateReturnFile:{url:"/returnFile/",method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"}},getPaymentList:{url:"/returnFile/transaction/payment",method:"GET"},postTemplate:{url:"/template",method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"}},putTemplate:{url:"/template",method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"}},getTemplate:{url:"/template",method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json"}},jobcategoryList:{url:"/job",method:"GET"},postAssignment:{url:"/jobAssignment",method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"}},getjobAssignments:{url:"/jobAssignment",method:"GET"},updateJobAssignment:{url:"/jobAssignment/",method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"}},forgotPassword:{url:"/user/forgotPassword",method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"}}}}]).factory("ApiCall",["$http","$resource","API","EnvService","ApiGenerator",function(a,b,c,d,e){return b("/",null,{getRole:e.getApi("getRole"),userLogin:e.getApi("userLogin"),getUser:e.getApi("getUser"),postUser:e.getApi("postUser"),getFiscalYear:e.getApi("getFiscalYear"),deleteUser:e.getApi("deleteUser"),updateUser:e.getApi("updateUser"),postReturnFile:e.getApi("postReturnFile"),getcount:e.getApi("getcount"),getReturnList:e.getApi("getReturnList"),getReturnFile:e.getApi("getReturnFile"),getItr:e.getApi("getItr"),postTransaction:e.getApi("postTransaction"),updateReturnFile:e.getApi("updateReturnFile"),getPaymentList:e.getApi("getPaymentList"),getReferral:e.getApi("getReferral"),getTemplate:e.getApi("getTemplate"),postTemplate:e.getApi("postTemplate"),putTemplate:e.getApi("putTemplate"),getReferralList:e.getApi("getReferralList"),getOverview:e.getApi("getOverview"),jobcategoryList:e.getApi("jobcategoryList"),postAssignment:e.getApi("postAssignment"),getjobAssignments:e.getApi("getjobAssignments"),updateJobAssignment:e.getApi("updateJobAssignment"),forgotPassword:e.getApi("forgotPassword")})}]).factory("ApiGenerator",["$http","$resource","API","EnvService",function(a,b,c,d){return{getApi:function(a){var b={};return b=angular.copy(c[a]),b.url=d.getBasePath()+b.url,b}}}]).factory("EnvService",["$http","$localStorage",function(a,b){var c=env={},d={};return{setSettings:function(a){d=a,this.setEnvData(a.envData)},getSettings:function(a){return a?d[a]:null},setEnvData:function(a){c=a[a.env]},getEnvData:function(){return c},getBasePath:function(a){return this.getEnvData().basePath}}}]),app.factory("UserModel",function(){var a={};return a.setUser=function(b){a.user=b},a.getUser=function(b){return a.user},a.unsetUser=function(b){a.user=null},a}),app.controller("EmailConfig_Controller",["$scope","$timeout","$rootScope","$state","$localStorage","NgTableParams","ApiCall","UserModel","Util","$stateParams",function(a,b,c,d,e,f,g,h,i,j){a.initTemplate=function(){a.template={},a.disabled=!1,j._id?(a.getTemplates(j._id),a.template.isReadOnly=!0):(a.orightml="",a.htmlcontent=a.orightml,a.template.isReadOnly=!1)},a.getTemplates=function(b){var c={};b&&(c._id=b),g.getTemplate(c,function(c){b?a.template=c.data[0]:(a.templateList=new f,a.templateList.settings({dataset:c.data}))},function(a){console.log("Error in fetching templates ",a)})},a.updateTemplate=function(){console.log(a.htmlcontent),j._id?g.putTemplate(a.template,function(a){i.alertMessage("success",a.message),d.go("emailConfig")},function(a){i.alertMessage("error",response.message)}):g.postTemplate(a.template,function(a){i.alertMessage("success",a.message),d.go("emailConfig")},function(a){i.alertMessage("error",response.message)})}}]),app.controller("Login_Controller",["$scope","$rootScope","$rootScope","$state","$localStorage","NgTableParams","ApiCall","$timeout","UserModel","Util",function(a,b,b,c,d,e,f,g,h,i){a.user={},a.user.username=d.user?d.user.uname:"",a.user.password=d.user?d.user.password:"",a.userLogin=function(){b.showPreloader=!0,f.userLogin(a.user,function(e){a.user.rememberMe&&(d.user={uname:a.user.username,password:a.user.password}),h.setUser(e.data.user),b.showPreloader=!1,d.token=e.data.token,b.is_loggedin=!0,console.log("logged in"),console.log(e),"superAdmin"!=e.data.user.role.type||e.data.user.father?"superAdmin"==e.data.user.role.type&&e.data.user.father?(c.go("dashboard"),console.log("2nd condition in")):e.data.user.father?(c.go("user-profile",{user_id:e.data.user._id}),console.log("3rd condition in")):"superAdmin"===e.data.user.role.type&&"client"===e.data.user.role.type||!e.data.user.father?(console.log("5th condition in"),c.go("profile-update")):(c.go("user-profile",{user_id:e.data.user._id}),console.log("4th condition in")):(console.log("ist condition in"),c.go("profile-update"))},function(a){b.showPreloader=!1,i.alertMessage("danger","Invalid username and password")})}}]),app.controller("Main_Controller",["$scope","$rootScope","$state","$localStorage","NgTableParams","ApiCall","UserModel","$uibModal","$stateParams","Util","$timeout",function(a,b,c,d,e,f,g,h,i,j,k){a.userList={},a.dashboard={},a.referList={};g.getUser();a.signOut=function(){delete d.token,b.is_loggedin=!1,g.unsetUser(),c.go("login")},a.getInternalUsers=function(b){a.internalCount=0;var c={userType:b};f.getUser(c,function(b){a.internalCount=b.data.length},function(a){})},a.getUserDetails=function(){var b=g.getUser(),c={_id:b._id};f.getUser(c,function(b){console.log(b),a.userDetails=b.data},function(a){})},a.getClientUsers=function(){a.clientCount=0,f.getUser(function(b){angular.forEach(b.data,function(b){"client"==b.role.type&&a.clientCount++})},function(a){})},a.checkAdmin=function(){a.superAdmin=!1;var b=g.getUser();return b&&b.role&&"superAdmin"==b.role.type?a.superAdmin=!0:a.superAdmin=!1,a.superAdmin},a.checkClient=function(){a.client=!1;var b=g.getUser();return b&&b.role&&"client"==b.role.type?a.client=!0:a.client=!1,a.client},a.checkInternalUser=function(){a.internalUser=!1;var b=g.getUser();return b&&b.role&&"client"==b.role.type?a.internalUser=!1:b&&b.role&&"superAdmin"==b.role.type?a.internalUser=!1:a.internalUser=!0,a.internalUser},a.deleteUser=function(b){a.deleteUserId=b._id,a.modalInstance=h.open({animation:!0,templateUrl:"view/modals/user-delete-modal.html",controller:"daleteUserModalCtrl",size:"md",resolve:{userDelete:function(){return a.userDelete}}})},a.userDelete=function(){f.deleteUser({_id:a.deleteUserId},function(b){j.alertMessage("success",b.message),a.getAllUsers()},function(a){})},a.getReturnCount=function(){f.getcount(function(b){a.returnFilesCounts=b.data},function(a){})}}]),app.controller("daleteUserModalCtrl",["$scope","$uibModalInstance","userDelete",function(a,b,c){a.ok=function(){c(),b.close()},a.cancel=function(){b.dismiss("cancel")}}]),app.controller("DatePickerCtrl",["$scope",function(a){a.today=function(){a.dt=new Date},a.today(),a.clear=function(){a.dt=null},a.toggleMin=function(){a.minDate=new Date,a.maxDate=new Date,a.dateMin=new Date},a.toggleMin(),a.open1=function(b){b.preventDefault(),b.stopPropagation(),a.opened=!0},a.dateOptions={formatYear:"yy",startingDay:1},a.mode="month",a.initDate=new Date,a.formats=["MM-dd-yyyy","dd-MMM-yyyy","dd-MMMM-yyyy","yyyy-MM-dd","dd/MM/yyyy","yyyy-MMM","shortDate"],a.format=a.formats[4],a.format1=a.formats[5]}]),app.controller("Referral_Controller",["$scope","$rootScope","$rootScope","$state","$localStorage","NgTableParams","ApiCall","$timeout","$stateParams",function(a,b,b,c,d,e,f,g,h){a.overviewList={},a.dashboard={},a.getReferralCount=function(){var b={count:!0};f.getReferral(b,function(b){a.dashboard.referralCount=b.data},function(a){console.log(a)})},a.referralList=function(){var b={};"referral-list"==c.current.name&&(console.log(32432),b.referredBy=h.referal_id),console.log(b),f.getReferralList(b,function(b){a.referList=b.data,a.listData=new e,a.listData.settings({dataset:a.referList})},function(a){console.log("error")})},a.referralOverviewList=function(){f.getOverview(function(b){console.log(b),a.overviewList=b.data,a.listOverview=new e,a.listOverview.settings({dataset:a.overviewList})},function(a){})}}]),app.controller("Return_Controller",["$scope","$rootScope","$rootScope","$state","$stateParams","$localStorage","NgTableParams","ApiCall","Util","$timeout","UserModel","$uibModal",function(a,b,b,c,d,e,f,g,h,i,j,k){a.user={},a.failTransaction={},a.user.isReferalPrompt=!1,a.active_tab1="income",a.list={},a.itrIdList={},a.yearList={},a.user.fiscalYear="",a.currentReturnFile={},a.active_tab="year",a.tabChange=function(b){a.active_tab=b},a.active_tab1="income",a.tabChangeDetails=function(b){a.active_tab1=b},a.checkAdmin=function(){a.superAdmin=!1;var b=j.getUser();return console.log(b),b&&"superAdmin"==b.role.type?a.superAdmin=!0:a.superAdmin=!1,a.superAdmin},a.checkStatus=function(b,d,e){return a.is_closed=!1,"payment"==c.current.name?("closed"!=b&&"processing"!=b&&null!=d&&0!=e||(a.is_closed=!0),a.is_closed):"return-file-list"==c.current.name?("closed"!=b&&"pending"!=b||(a.is_closed=!0),a.is_closed):a.is_closed},a.checkPending=function(b){return a.is_pending=!1,"closed"!=b&&"processing"!=b&&"failed"!=b||(a.is_pending=!0),a.is_pending},a.returnFile=function(){a.tempFormXvi&&a.tempFormXvi.imageName&&(a.user.formXvi={fileName:a.tempFormXvi.imageName,base64:a.tempFormXvi.image.split(";base64,")[1]},a.user.isFormXvi=!0),a.user.client=j.getUser()._id,a.user.isReferalPrompt?g.postReturnFile(a.user,function(a){h.alertMessage("success","Data Saved Successfully");var b=j.getUser();c.go("user-profile",{user_id:b._id})},function(a){h.alertMessage("danger",a.data.message)}):a.modalInstance=k.open({animation:!0,templateUrl:"view/modals/reference_info_modal.html",controller:"ReferalInfoModalController",size:"md",resolve:{userData:function(){return a.user}}})},a.returnFileList=function(){var b={status:d.status};console.log(b),g.getReturnList(b,function(b){a.list=b.data,a.returnList=new f,a.returnList.settings({dataset:a.list})},function(a){console.error(a)})},a.showFiscalYear=function(){var b=j.getUser();console.log(b);var e={};"previous-return-file-details"==c.current.name&&b&&"superAdmin"==b.role.type?e.client=d.client_id:"previous-return-file-details"==c.current.name&&b&&"superAdmin"!=b.role.type&&(e.client=b._id),console.log(e),g.getFiscalYear(e,function(b){console.log(b),a.yearList=b.data},function(a){})},a.getItrId=function(){var b=j.getUser(),c={client:b._id};g.getItr(c,function(b){a.itrIdList=b.data},function(a){})},a.changeReturnFileStatus=function(b){a.currentReturnFile={},a.currentReturnFile._id=b,a.user.status="closed",""!=a.user.fiscalYear&&a.user.fiscalYear||delete a.user.fiscalYear,a.modalInstance=k.open({animation:!0,templateUrl:"view/modals/return-file-closing-modal.html",controller:"ReturnFileClosingModalCtrl",size:"md",resolve:{userReturnData:function(){return a.userReturnData}}})},a.userReturnData=function(b){a.currentReturnFile.returnAmount=b.returnAmount,a.currentReturnFile.returnDate=b.returnDate,a.currentReturnFile.status="closed",g.updateReturnFile(a.currentReturnFile,function(a){h.alertMessage("success","Return File Closed Successfully"),c.go("return-file-list")},function(a){console.log(a)})},a.changeStatusProcessing=function(b){a.user._id=b,a.user.status="processing",a.user.successMessage="Payment Success",a.user.failedMessage="null",""!=a.user.fiscalYear&&a.user.fiscalYear||delete a.user.fiscalYear,g.updateReturnFile(a.user,function(a){h.alertMessage("success","Payment Verified Successfully"),c.go("payment")},function(a){h.alertMessage("Failed")})},a.failTransaction=function(b){a.failedReturnFileId=b._id,a.modalInstance=k.open({animation:!0,templateUrl:"view/modals/fail-transaction-modal.html",controller:"FailTransacModalCtrl",size:"md",resolve:{sendFailMessage:function(){return a.sendFailMessage}}})},a.sendFailMessage=function(b){a.returnFileToFail=b,a.returnFileToFail._id=a.failedReturnFileId,a.returnFileToFail.status="failed",g.updateReturnFile(a.returnFileToFail,function(a){h.alertMessage("success","Transaction Status Successfully Changed To 'Failed' "),c.go("payment")},function(a){h.alertMessage("danger","Failed")})},a.returnFileDetails=function(){var b=j.getUser();console.log(c);var e={};"previous-return-file-details"==c.current.name&&b&&"superAdmin"==b.role.type?(e.fiscalYear=a.user.fiscalYear,e.client=d.client_id):"previous-return-file-details"==c.current.name&&b&&"superAdmin"!=b.role.type?(e.fiscalYear=a.user.fiscalYear,e.client=b._id):"returnFile-details"==c.current.name&&b&&"superAdmin"==b.role.type&&(e._id=d.returnFile_id),g.getReturnFile(e,function(b){console.log(b),a.returnDetails=b.data[0],console.log(a.returnDetails),a.returnDetails&&(a.returnDetails.total=0,a.returnDetails.conEmpInc&&(a.returnDetails.total=parseFloat(a.returnDetails.total)+parseFloat(a.returnDetails.conEmpInc)),a.returnDetails.businessInc&&(a.returnDetails.total=parseFloat(a.returnDetails.total)+parseFloat(a.returnDetails.businessInc)),a.returnDetails.capitalGainInc&&(a.returnDetails.total=parseFloat(a.returnDetails.total)+parseFloat(a.returnDetails.capitalGainInc)),a.returnDetails.rentalInc&&(a.returnDetails.total=parseFloat(a.returnDetails.total)+parseFloat(a.returnDetails.rentalInc)),a.returnDetails.houseLoanInterestInc&&($socpe.returnDetails.total=parseFloat(a.returnDetails.total)+parseFloat(a.returnDetails.houseLoanInterestInc)),a.returnDetails.fixDepositInc&&(a.returnDetails.total=parseFloat(a.returnDetails.total)+parseFloat(a.returnDetails.fixDepositInc)),a.returnDetails.savingAcInc&&(a.returnDetails.total=parseFloat(a.returnDetails.total)+parseFloat(a.returnDetails.savingAcInc)),a.returnDetails.otherInc&&(a.returnDetails.total=parseFloat(a.returnDetails.total)+parseFloat(a.returnDetails.otherInc)),a.user.total&&(a.returnDetails.total=a.user.total.toFixed(2)))},function(a){})},a.paymentConfirm=function(){""!=a.user.fiscalYear&&a.user.fiscalYear||delete a.user.fiscalYear,g.postTransaction(a.user,function(b){console.log(a.user),g.updateReturnFile(a.user,function(a){console.log(a)},function(a){}),h.alertMessage("success","Payment Confirmed Successfully");var d=j.getUser();c.go("user-profile",{user_id:d._id})},function(a){})},a.getPayment=function(){g.getPaymentList(function(b){console.log(b),a.paymentList=b.data,a.paymentsList=new f,a.paymentsList.settings({dataset:a.paymentList})},function(a){})},a.getUserDetails=function(a){var b={};"referral-overview"==c.current.name?b._id=a._id:b._id=a.client,console.log(b),g.getUser(b,function(b){console.log(b),a.userDetails=b.data},function(a){console.log("error")})},a.incomeCalculation=function(){a.user.total=0,a.user.conEmpInc&&(a.user.total=parseFloat(a.user.total)+parseFloat(a.user.conEmpInc)),a.user.businessInc&&(a.user.total=parseFloat(a.user.total)+parseFloat(a.user.businessInc)),a.user.capitalGainInc&&(a.user.total=parseFloat(a.user.total)+parseFloat(a.user.capitalGainInc)),a.user.rentalInc&&(a.user.total=parseFloat(a.user.total)+parseFloat(a.user.rentalInc)),a.user.houseLoanInterestInc&&(a.user.total=parseFloat(a.user.total)+parseFloat(a.user.houseLoanInterestInc)),a.user.fixDepositInc&&(a.user.total=parseFloat(a.user.total)+parseFloat(a.user.fixDepositInc)),a.user.savingAcInc&&(a.user.total=parseFloat(a.user.total)+parseFloat(a.user.savingAcInc)),a.user.otherInc&&(a.user.total=parseFloat(a.user.total)+parseFloat(a.user.otherInc)),a.user.total=a.user.total.toFixed(2)}}]),app.controller("FailTransacModalCtrl",["$scope","$state","$uibModalInstance","sendFailMessage",function(a,b,c,d){a.failTransaction={},a.fail=function(){d(a.failTransaction),c.close()},a.cancel=function(){c.dismiss("cancel")}}]),app.controller("ReferalInfoModalController",["$scope","$uibModalInstance","userData","$uibModal","Util",function(a,b,c,d,e){c.isReferalPrompt=!0,a.ok=function(){c.referralEmail=a.referralEmail,c.referralMobile=a.referralMobile,b.close(),a.modalInstance=d.open({animation:!0,templateUrl:"view/modals/reference_confirm_modal.html",controller:"ReferalConfirmModalController",size:"md"})},a.cancel=function(){b.dismiss("cancel")}}]),app.controller("ReferalConfirmModalController",["$scope","$uibModalInstance",function(a,b){a.cancel=function(){b.close("cancel")}}]),app.controller("ReturnFileClosingModalCtrl",["$scope","$uibModalInstance","ApiCall","userReturnData",function(a,b,c,d){a.user={},a.cancel=function(){b.dismiss("cancel")},a.close=function(){d(a.user),b.close("cancel")}}]),app.controller("User_Controller",["$scope","$timeout","LOG","$rootScope","$state","$location","$window","$localStorage","NgTableParams","ApiCall","UserModel","Util","$stateParams",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.user={},a.tempAdhar={},a.tempPAN={},a.userDetails={},a.roles=[],a.userList=[],a.clientUserList={},a.active_tab="details",a.tabChange=function(b){a.active_tab=b},a.getRoll=function(b){j.getRole(function(c){b?angular.forEach(c.data,function(b){"client"==b.type&&(a.user.role=b._id)}):angular.forEach(c.data,function(b){"client"==b.type||"superAdmin"==b.type||a.roles.push(b)})})},a.checkPassword=function(b,c){b!=c&&(a.showPasswordMisMatch=!0),b==c&&(a.showPasswordMisMatch=!1)},a.registerUser=function(){d.showPreloader=!0,j.postUser(a.user,function(a){d.showPreloader=!1,200==a.statusCode?(l.alertMessage("success","You have successfully register please check your mail"),e.go("login")):l.alertMessage("danger","Something went wrong please try again")},function(a){500==a.data.statusCode&&(a.data.data.errors.email?l.alertMessage("danger",a.data.data.errors.email.message):a.data.data.errors.mobile&&l.alertMessage("danger",a.data.data.errors.mobile.message),d.showPreloader=!1)})},a.profileUpdate=function(){a.tempAdhar.imageName&&(a.user.adharDetails={fileName:a.tempAdhar.imageName,base64:a.tempAdhar.image.split(";base64,")[1]}),a.tempPAN.imageName&&(a.user.panDetails={fileName:a.tempPAN.imageName,base64:a.tempPAN.image.split(";base64,")[1]}),a.user._id=k.getUser()._id,d.showPreloader=!0,j.updateUser(a.user,function(a){d.showPreloader=!1,k.setUser(a.data.user),h.token=a.data.token;var b=k.getUser();l.alertMessage("success","Data Updated Successfully"),e.go("user-profile",{user_id:b._id})},function(a){d.showPreloader=!1})},a.getUserDetails=function(c){a.client_id=c,b(function(){if(a.user=k.getUser(),a.user||m.user_id||a.client_id){var b={_id:m.user_id||a.user._id||a.client_id};j.getUser(b,function(b){console.log(b),a.userDetails=b.data,a.userDetails.pin=parseInt(a.userDetails.pin)},function(a){})}})},a.getUser=function(b){if(a.user._id=b,a.user._id){var c={_id:a.user._id};j.getUser(c,function(b){console.log(b),a.userDetails=b.data},function(a){})}},a.getAllUsers=function(){var b={};b.userType=m.userType,j.getUser(b,function(b){a.userList=b.data,a.userData=new i,a.userData.settings({dataset:a.userList})},function(a){})},a.onForgotPassword=function(a){var b={email:a};j.forgotPassword(b,function(a){c.info(a.message)},function(a){c.error(response.message)})}}]),app.controller("Work_Assignment_Controller",["$scope","$rootScope","$rootScope","$state","$localStorage","NgTableParams","UserModel","$timeout","ApiCall","Util","$stateParams",function(a,b,b,c,d,e,f,g,h,i,j){a.user={},a.categoryList={},a.task={},a.assignmentList={},a.roles=[],a.userList={},a.jobAssignmentList={},a.jobDetails={},a.userDetails={},a.createWork={},a.taskList=[],a.assignedJobs=[],a.getJobCategoryList=function(){h.jobcategoryList(function(b){a.categoryList=b.data},function(a){})},a.getAssignmentList=function(){var b={};"create-task"==c.current.name?b.category=a.createWork.category:"work-assignment"==c.current.name&&(b.category=a.task.category),h.jobcategoryList(b,function(b){a.assignmentList=b.data[0].assignment},function(a){console.error(a)})},a.showRetunFile=function(){"pending"!=a.task.assignment&&"processing"!=a.task.assignment||"Return File"!=a.task.category?a.task.showReturnFile=!1:a.task.showReturnFile=!0},a.getReturnFiles=function(){var b={status:a.task.assignment};h.getReturnList(b,function(b){a.task.returnFiles=b.data},function(a){console.error(a)})},a.getRoles=function(){h.getRole(function(b){angular.forEach(b.data,function(b){"client"==b.type||"superAdmin"==b.type||a.roles.push(b)})},function(a){console.error(a)})},a.getUserOfSelectedrole=function(){var b={role:a.task.role};h.getUser(b,function(b){a.userList=b.data},function(a){})},a.checkInternalUser=function(){a.internalUser=!1;var b=f.getUser();return b&&"client"==b.role.type?a.internalUser=!1:b&&"superAdmin"==b.role.type?a.internalUser=!1:a.internalUser=!0,a.internalUser},a.workAssignConfirm=function(){a.task._id=a.task.workName,delete a.task.workName,b.showPreloader=!0,h.updateJobAssignment(a.task,function(a){b.showPreloader=!1,i.alertMessage("success","Job Assigned Successfully"),c.go("dashboard")},function(a){})},a.getAssignedJobs=function(){var b=f.getUser(),c={};b&&"superAdmin"!==b.role.type&&(c.user=b._id),h.getjobAssignments(c,function(b){a.pendingAssignedJobs=[],a.processAssignedJobs=[],a.completedAssignedJobs=[],a.assignedJobs=[],a.taskList=[],angular.forEach(b.data,function(b){b.user?a.assignedJobs.push(b):a.taskList.push(b)}),a.assignedJobData=new e,a.assignedJobData.settings({dataset:a.assignedJobs}),a.notAssignedJobData=new e,a.notAssignedJobData.settings({dataset:a.taskList}),console.log(a.assignedJobs),angular.forEach(a.assignedJobs,function(b){"pending"==b.status?a.pendingAssignedJobs.push(b):"In_Progress"==b.status?a.processAssignedJobs.push(b):"Completed"==b.status&&a.completedAssignedJobs.push(b)})},function(a){})},a.getUserName=function(a){var b={_id:a.user};h.getUser(b,function(b){a.userDetails=b.data},function(a){})},a.getJobDetails=function(){var b={_id:j.job_id};h.getjobAssignments(b,function(b){a.task=b.data[0];var c={};a.task.role&&(c._id=a.task.role,h.getRole(c,function(b){a.roleType=b.data[0].type},function(a){}));var d={_id:a.task.user};h.getUser(d,function(b){a.userFirstname=b.data.firstname,a.userLastname=b.data.lastname},function(a){})},function(a){})},a.updateJobStatus=function(){h.updateJobAssignment(a.task,function(a){i.alertMessage("success","Status Updated Successfully"),c.go("work-assigned")},function(a){})},a.taskCreation=function(){var d=f.getUser();d&&"client"==d.role.type&&(a.createWork.createdBy=d._id,a.createWork.createdFor=d._id),b.showPreloader=!0,h.postAssignment(a.createWork,function(a){b.showPreloader=!1,i.alertMessage("success","Job created Successfully"),c.go("user-profile",{user_id:d._id})},function(a){console.log("error")})},a.getTaskList=function(){a.taskList=[];var b=f.getUser(),c={};b&&"client"==b.role.type&&(c.createdFor=b._id),h.getjobAssignments(c,function(b){a.jobAssignmentList=b.data,angular.forEach(a.jobAssignmentList,function(b){b.user||a.taskList.push(b)}),a.createdTaskData=new e,a.createdTaskData.settings({dataset:a.jobAssignmentList})},function(a){})},a.getTaskDetails=function(){var b={_id:a.task.workName};h.getjobAssignments(b,function(b){a.task.category=b.data[0].category,a.task.assignment=b.data[0].assignment,a.task.description=b.data[0].description},function(a){})}}]),app.directive("fileModell",["$parse",function(a){return{restrict:"A",link:function(b,c,d){var e=a(d.fileModel),f=e.assign;c.bind("change",function(){b.$apply(function(){
f(b,c[0].files[0])})})}}}]),app.directive("updateHeight",function(){return{restrict:"A",link:function(a,b,c){$ta=b;var d=$(window).height();$ta.css({"min-height":d-100+"px"})}}}),app.directive("fileModel",["$parse",function(a){return{restrict:"A",scope:{fileread:"=",filename:"="},link:function(a,b,c){b.bind("change",function(){var c=new FileReader;c.onload=function(c){a.$apply(function(){a.fileread=c.target.result,a.filename=b[0].files[0].name})},c.readAsDataURL(b[0].files[0])})}}}]),app.directive("numbersOnly",function(){return{require:"ngModel",link:function(a,b,c,d){function e(a){if(a){var b=a.replace(/[^0-9]/g,"");return b!==a&&(d.$setViewValue(b),d.$render()),b}}d.$parsers.push(e)}}}),app.directive("floatsOnly",function(){return{require:"ngModel",link:function(a,b,c,d){function e(a){var b=a.replace(/[^[0-9\.]/g,"");return b!==a&&(d.$setViewValue(b),d.$render()),b}d.$parsers.push(e)}}}),app.directive("capitalize",["uppercaseFilter","$parse",function(a,b){return{require:"ngModel",link:function(a,c,d,e){var f=function(a){if(a){input=a.toLowerCase();var b=input.substring(0,3).toUpperCase();return b!==a&&(e.$setViewValue(b),e.$render()),b}},g=b(d.ngModel);e.$parsers.push(f),f(g(a))}}}]);